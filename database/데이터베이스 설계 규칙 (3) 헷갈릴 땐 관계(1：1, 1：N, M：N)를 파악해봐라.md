# 데이터베이스 설계 규칙 (3) 헷갈릴 땐 관계(1：1, 1：N, M：N)를 파악해봐라

---

## 1. 관계의 종류
- 1:1
- 1:N
- M:N

---

## 2. 엔티티 간 관계 파악
1. 엔티티 간에 어울리는 동사 찾기
   - `A(주어)가 B를 _____.` (A가 주어)
   - `B(주어)가 A에 의해 ______.` (B가 주어)  
   - **서비스의 관점에서 동사를 떠올려야 한다.**
2. 1번 과정에서 찾은 동사를 활용해 적절한 단어(`하나의` or `여러 개의`) 찾기
   - `하나의 A는 (하나의 or 여러 개의) B를 _______.` (A의 관점)
   - `하나의 B는 (하나의 or 여러 개의) A에 의해 _______.` (B의 관점)
   - **문장 처음에 시작하는 `하나의`라는 말을 반드시 붙여야 헷갈리지 않는다.**
   - **서비스를 어떻게 기획하냐에 따라 달라질 수 있다. 반드시 자신의 서비스에 대입해서 생각해야 한다.**

3. 관계 판단하기
   - A, B의 관점 전부 다 `하나`만 기진다면 → A : B = 1 : 1
   - A의 관점에서는 `여러개`의 B를 가지고, B의 관점에서는 `하나`의 A를 가진다면 → A : B = 1 : N
   - A의 관점에서는 `하나`의 B를 가지고, B의 관점에서는 `여러개`의 A를 가진다면 → A : B = N : 1
   - A, B의 관점 전부 다 `여러개`를 가진다면 → A : B = M:N

---

## 3. 1:N

### 3.1 특징
- N 쪽의 테이블에 FK가 들어가야 한다.

### 3.2 예시
**사용자 (users), 이메일(emails)**  
_(한 명의 사용자가 회원가입 할 때 여러 개의 이메일을 입력할 수 있는 서비스라고 가정하자.)_
  - 사용자가 이메일을 **소유한다.**
  - 이메일은 사용자에 의해 **소유된다.**
  - 한 명의 사용자는 **여러 개의** 이메일을 **소유한다(소유할 수 있다).**
  - 하나의 이메일은 **한 명의** 사용자에 의해 **소유된다.**

**⇒ 사용자 : 이메일 = 1 : N 관계**

### 3.3 예시(실제 테이블로 보기)
#### 3.3.1 \[Before\]
**users(사용자)**

| id(PK) | 이름 | 이메일 |
| --- | --- | --- |
| 1 | 땃쥐 | `abc@gmail.com,def@naver.com,ghi@kakao.com`|
| 2 | 땃고양이 | `123@gmail.com,456@naver.com,456@naver.com` |

#### 3.3.2 \[After\]
**users(사용자)**

| id(PK) | 이름 |
| --- | --- |
| 1 | 땃쥐 |
| 2 | 땃고양이 |

**emails(이메일)**

| id(PK) | email | user_id(FK) |
| --- | --- | --- |
| 1 | `abc@gmail.com` | 1 |
| 2 | `def@naver.com` | 1 |
| 3 | `ghi@kakao.com` | 1 |
| 4 | `123@gmail.com` | 2 |
| 5 | `456@naver.com` | 2 |

---

## 4. 1:1

### 4.1 특징
_(DB 설계할 때는 1:1 관계가 생각보다 잘 안 나옴)_
- 아무 테이블에 FK를 넣어도 된다.
- 합쳐도 되는 지 고려해봐야 한다.
  (어지간하면 1:1 관계로 분리하지 않는 걸 권장)

### 4.2 예시
**사용자(users), 프로필(profiles)**  
  - 사용자는 프로필을 **가진다.**
  - 프로필은 사용자에 의해 **소유된다.**
  - 한 명의 사용자는 **한 개의** 프로필만 **가진다(가질 수 있다).**
  - 한 개의 프로필은 **한 명의** 사용자한테만 소유된다.  

⇒ **사용자 : 프로필 = 1 : 1 관계**


### 4.3 예시(실제 테이블로 보기)

#### 4.3.1 \[Before\]
**users(사용자)**

| id(PK) | 이메일                    | 프로필사진     | 닉네임 | 자기소개      |
|--------|------------------------|-----------|-----|-----------|
| 1      | `ttasjwi920@gmail.com` | `abc.jpg` | 땃쥐  | 고양이가 무서워요 |
| 2      | `kyaru@gmail.com`      | `cde.jpg` | 캬루  | 쥐를 잡고 싶어요 |

#### 4.3.2 \[After\]
**users(사용자)**

| id(PK) | 이메일                    |
|--------|------------------------|
| 1      | `ttasjwi920@gmail.com` |
| 2      | `kyaru@gmail.com`      |

**profiles(프로필)**

| id(PK) | 프로필사진     | 닉네임 | 자기소개      | 사용자 id(FK) |
|--------|-----------|-----|-----------|------------|
| 1      | `abc.jpg` | 땃쥐  | 고양이가 무서워요 | 1          |
| 2      | `cde.jpg` | 캬루  | 쥐를 잡고 싶어요 | 2          |

---

## 5. M:N

### 5.1 특징
- 중간 테이블이 있어야 한다.
- 중간 테이블에 두 테이블의 FK가 들어가야 한다.
- M:N 관계에서 중간 테이블을 추가해 `1:X` 관계로 풀어 표현하게 된다.

### 5.2 예시
**사용자(users)와 게시글(posts) 좋아요**  
  - 사용자는 게시글을 **좋아한다.** 
  - 게시글은 사용자에 의해 **좋아요 받는다.**(엄청 자연스럽지 않아도 된다.)
  - 하나의 사용자는 **여러** 게시글을 **좋아한다(좋아요 할 수 있다)**.
  - 하나의 게시글은 **여러** 사용자에 의해 **좋아요 받는다(좋아요 받을 수 있다)**.

⇒ **사용자 : 게시글 = M : N**


### 5.3 예시(실제 테이블로 보기)

#### 5.3.1 \[Before\]
**users(사용자)**

| id(PK) | 이름   | 좋아요한 게시글 |
|--------|------|----------|
| 1      | 땃쥐   | 2,3,5    |
| 2      | 캬루   | 3        |
| 3      | 냐루   | 1, 4     |
| 4      | 땃고양이 | 3, 5     |

**posts(게시글)**

| id(PK) | 게시글 제목                  | 게시글 내용                                   | 작성자 id(FK) |
|--------|-------------------------|------------------------------------------|------------|
| 1      | 다들 경력직만 뽑아요             | 저같은 신입은 어디서 일해요...                       | 1          |
| 2      | 쿠폰 1만개 선착순 발급하는데 도움좀요   | 테스트해보니까 1만명보다 많은 사람이...                  | 2          | 
| 3      | 인덱스를 사용해 DB 성능을 개선하는 방법 | 인덱스를 사용해서 삽입 성능을 손해보는 대신, ...            | 3          | 
| 4      | 오점추 좀...                | 떡볶이? 김밥? 햄버거?                            | 4          |
| 5      | 쿠폰 1만개 발급하는 분 봐주세요      | 락을 통해 문제를 해결해야해요. 가장 저렴한 비용으로 할 수 있는건... | 1          |
                   

#### 5.3.2 \[After\]
**users(사용자)**

| id(PK) | 이름   |
|--------|------|
| 1      | 땃쥐   |
| 2      | 캬루   |
| 3      | 냐루   |
| 4      | 땃고양이 |

**post_likes(게시글 좋아요)**

| id(PK) | 사용자 id(FK) | 게시글 id(FK) |
|--------|------------|------------|
| 1      | 1          | 2          | 
| 2      | 1          | 3          |
| 3      | 1          | 5          |
| 4      | 2          | 3          |
| 5      | 3          | 1          |
| 6      | 3          | 4          |
| 7      | 4          | 3          |
| 8      | 4          | 5          |

**posts(게시글)**

| id(PK) | 게시글 제목                  | 게시글 내용                                   | 작성자 id(FK) |
|--------|-------------------------|------------------------------------------|------------|
| 1      | 다들 경력직만 뽑아요             | 저같은 신입은 어디서 일해요...                       | 1          |
| 2      | 쿠폰 1만개 선착순 발급하는데 도움좀요   | 테스트해보니까 1만명보다 많은 사람이...                  | 2          | 
| 3      | 인덱스를 사용해 DB 성능을 개선하는 방법 | 인덱스를 사용해서 삽입 성능을 손해보는 대신, ...            | 3          | 
| 4      | 오점추 좀...                | 떡볶이? 김밥? 햄버거?                            | 4          |
| 5      | 쿠폰 1만개 발급하는 분 봐주세요      | 락을 통해 문제를 해결해야해요. 가장 저렴한 비용으로 할 수 있는건... | 1          |

---

